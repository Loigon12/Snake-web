<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Snake — Sebastian Londoño</title>
    <style>
        body {
            background-color: #1a1a1a;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: white;
            overflow: hidden; /* Evita scroll accidental en móvil */
        }

        #scoreboard {
            width: 100%;
            max-width: 600px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 20px;
            background-color: #0d0d0d;
            border-bottom: 2px solid #501414;
            box-sizing: border-box;
            font-size: 18px;
            font-weight: bold;
        }

        #game-container {
            position: relative;
            width: 600px;
            height: 600px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            touch-action: none; /* Crucial: evita que el navegador deslice la página al tocar el juego */
        }

        canvas {
            background-color: #0d0d0d;
            display: block;
            max-width: 100%;
            height: auto;
        }

        #restart-button {
            background-color: rgba(40, 40, 40, 0.9);
            color: white;
            border: 1px solid rgb(70, 70, 70);
            padding: 8px 16px;
            font-weight: bold;
            cursor: pointer;
            outline: none;
        }

        #game-over-overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            pointer-events: none;
        }

        @media (max-width: 620px) {
            #game-container, #scoreboard { width: 95vw; }
            #game-container { height: 95vw; }
        }
    </style>
</head>
<body>

<div id="scoreboard">
    <div id="score-text">Manzanas: 0</div>
    <div id="high-score-text">Record: 0</div>
    <button id="restart-button">Reiniciar</button>
</div>

<div id="game-container">
    <canvas id="snakeGame" width="600" height="600"></canvas>
    <div id="game-over-overlay">
        <h1 style="color: red; font-size: clamp(32px, 8vw, 48px);">¡Game Over!</h1>
        <p id="final-score" style="font-size: 24px;">Puntuación: 0</p>
        <p style="font-size: 16px; color: #aaa;">Toca 'Reiniciar' o presiona 'R'</p>
    </div>
</div>

<script>
    // === Configuración [cite: 43-46] ===
    const GRID_SIZE = 25;
    const BOARD_SIZE = 600;
    const COLUMNS = BOARD_SIZE / GRID_SIZE;
    const ROWS = BOARD_SIZE / GRID_SIZE;
    const INITIAL_BODY_PARTS = 6;
    const TIMER_DELAY = 120;

    const canvas = document.getElementById('snakeGame');
    const ctx = canvas.getContext('2d');
    const scoreElement = document.getElementById('score-text');
    const highScoreElement = document.getElementById('high-score-text');
    const overlay = document.getElementById('game-over-overlay');

    let snake = [];
    let appleX, appleY, applesEaten = 0;
    let direction = 'R'; // [cite: 107]
    let running = false;
    let gameTimer;
    let highScore = localStorage.getItem('snakeHighScore') || 0;

    // --- Soporte Táctil (Swipe) ---
    let touchStartX = 0;
    let touchStartY = 0;

    function startGame() {
        snake = [];
        for (let i = 0; i < INITIAL_BODY_PARTS; i++) {
            snake.push({ x: (Math.floor(COLUMNS / 2) - i) * GRID_SIZE, y: (Math.floor(ROWS / 2)) * GRID_SIZE });
        }
        applesEaten = 0;
        direction = 'R';
        running = true;
        overlay.style.display = 'none';
        updateScore();
        spawnApple();
        if (gameTimer) clearInterval(gameTimer);
        gameTimer = setInterval(gameLoop, TIMER_DELAY);
    }

    function spawnApple() {
        let overlaps;
        do {
            overlaps = false;
            appleX = Math.floor(Math.random() * COLUMNS) * GRID_SIZE;
            appleY = Math.floor(Math.random() * ROWS) * GRID_SIZE;
            snake.forEach(p => { if(p.x === appleX && p.y === appleY) overlaps = true; });
        } while (overlaps);
    }

    function gameLoop() {
        if (running) {
            // Mover [cite: 102-107]
            const head = { ...snake[0] };
            if (direction === 'U') head.y -= GRID_SIZE;
            else if (direction === 'D') head.y += GRID_SIZE;
            else if (direction === 'L') head.x -= GRID_SIZE;
            else if (direction === 'R') head.x += GRID_SIZE;

            snake.unshift(head);

            // Colisión Manzana [cite: 108]
            if (head.x === appleX && head.y === appleY) {
                applesEaten++;
                updateScore();
                spawnApple();
            } else {
                snake.pop();
            }

            // Colisiones [cite: 110-112]
            if (head.x < 0 || head.x >= BOARD_SIZE || head.y < 0 || head.y >= BOARD_SIZE ||
                snake.slice(1).some(p => p.x === head.x && p.y === head.y)) {
                endGame();
            }
        }
        render();
    }

    function endGame() {
        running = false;
        clearInterval(gameTimer);
        if (applesEaten > highScore) {
            highScore = applesEaten;
            localStorage.setItem('snakeHighScore', highScore);
        }
        document.getElementById('final-score').innerText = `Puntuación: ${applesEaten}`;
        overlay.style.display = 'flex';
        updateScore();
    }

    function updateScore() {
        scoreElement.innerText = `Manzanas: ${applesEaten}`;
        highScoreElement.innerText = `Record: ${highScore}`;
    }

    function render() {
        ctx.fillStyle = '#0d0d0d'; // Fondo [cite: 57]
        ctx.fillRect(0, 0, BOARD_SIZE, BOARD_SIZE);

        // Cuadrícula [cite: 79-81]
        ctx.strokeStyle = '#1e1e1e';
        for(let i=0; i<=BOARD_SIZE; i+=GRID_SIZE) {
            ctx.beginPath(); ctx.moveTo(i,0); ctx.lineTo(i,BOARD_SIZE); ctx.stroke();
            ctx.beginPath(); ctx.moveTo(0,i); ctx.lineTo(BOARD_SIZE,i); ctx.stroke();
        }

        // Borde [cite: 82]
        ctx.strokeStyle = '#501414';
        ctx.lineWidth = 2;
        ctx.strokeRect(1, 1, BOARD_SIZE-2, BOARD_SIZE-2);

        if (running) {
            // Manzana [cite: 85-86]
            ctx.fillStyle = 'red';
            ctx.beginPath(); ctx.arc(appleX+GRID_SIZE/2, appleY+GRID_SIZE/2, GRID_SIZE/2.2, 0, Math.PI*2); ctx.fill();
            ctx.fillStyle = 'white';
            ctx.beginPath(); ctx.arc(appleX+GRID_SIZE/3, appleY+GRID_SIZE/4, GRID_SIZE/8, 0, Math.PI*2); ctx.fill();

            // Serpiente [cite: 88-89]
            snake.forEach((p, i) => {
                ctx.fillStyle = (i === 0) ? '#32CD32' : '#228B22';
                ctx.fillRect(p.x, p.y, GRID_SIZE, GRID_SIZE);
                ctx.strokeStyle = '#222';
                ctx.strokeRect(p.x, p.y, GRID_SIZE, GRID_SIZE);
            });
        }
    }

    // --- Controles de Teclado (Flechas + WASD)  ---
    window.addEventListener('keydown', e => {
        const key = e.key.toLowerCase();
        if (key === 'r') startGame();
        if (!running) return;

        if ((key === 'arrowup' || key === 'w') && direction !== 'D') direction = 'U';
        else if ((key === 'arrowdown' || key === 's') && direction !== 'U') direction = 'D';
        else if ((key === 'arrowleft' || key === 'a') && direction !== 'R') direction = 'L';
        else if ((key === 'arrowright' || key === 'd') && direction !== 'L') direction = 'R';
    });

    // --- Controles Táctiles (Deslizar) ---
    canvas.addEventListener('touchstart', e => {
        touchStartX = e.changedTouches[0].screenX;
        touchStartY = e.changedTouches[0].screenY;
    }, false);

    canvas.addEventListener('touchend', e => {
        if (!running) return;
        let diffX = e.changedTouches[0].screenX - touchStartX;
        let diffY = e.changedTouches[0].screenY - touchStartY;

        // Determinar si el deslizamiento fue mayormente horizontal o vertical
        if (Math.abs(diffX) > Math.abs(diffY)) {
            if (Math.abs(diffX) > 30) { // Umbral de sensibilidad
                if (diffX > 0 && direction !== 'L') direction = 'R';
                else if (diffX < 0 && direction !== 'R') direction = 'L';
            }
        } else {
            if (Math.abs(diffY) > 30) {
                if (diffY > 0 && direction !== 'U') direction = 'D';
                else if (diffY < 0 && direction !== 'D') direction = 'U';
            }
        }
    }, false);

    document.getElementById('restart-button').onclick = startGame;
    startGame();
</script>
</body>
</html>