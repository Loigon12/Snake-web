<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Snake — Sebastian Londoño</title>
    <style>
        :root {
            --bg-color: #0d0d0d;
            --border-color: #501414;
            --snake-head: #32CD32;
            --snake-body: #228B22;
            --accent-red: #ff4d4d;
        }

        body {
            background-color: #1a1a1a;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            font-family: 'Segoe UI', sans-serif;
            color: white;
            overflow: hidden;
        }

        /* --- PANTALLA DE CARGA MEJORADA --- */
        #startup-screen {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background-color: var(--bg-color);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
            transition: opacity 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .loader-wrapper {
            text-align: center;
            width: 300px;
        }

        .snake-animation {
            position: relative;
            height: 60px;
            margin-bottom: 30px;
            overflow: hidden;
        }

        .moving-snake {
            position: absolute;
            width: 80px; height: 15px;
            background: var(--snake-head);
            border-radius: 10px;
            box-shadow: 0 0 15px var(--snake-head);
            left: -100px;
            animation: snakeRun 2.5s infinite ease-in-out;
        }

        .target-apple {
            position: absolute;
            width: 15px; height: 15px;
            background: red;
            border-radius: 50%;
            right: 50px; top: 0;
            box-shadow: 0 0 10px red;
            animation: applePulse 0.8s infinite alternate;
        }

        @keyframes snakeRun {
            0% { left: -100px; }
            40% { left: 160px; width: 80px; }
            50% { left: 180px; width: 100px; }
            60% { left: 220px; width: 50px; }
            100% { left: 400px; }
        }

        @keyframes applePulse {
            from { transform: scale(1); opacity: 1; }
            to { transform: scale(1.3); opacity: 0.7; }
        }

        /* Barra de progreso */
        .progress-container {
            width: 100%;
            height: 6px;
            background: #222;
            border-radius: 10px;
            margin-top: 20px;
            overflow: hidden;
        }

        .progress-bar {
            width: 0%;
            height: 100%;
            background: linear-gradient(90deg, var(--snake-body), var(--snake-head));
            transition: width 0.1s;
        }

        #begin-button {
            display: none;
            background: transparent;
            color: white;
            border: 2px solid var(--border-color);
            padding: 12px 35px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            letter-spacing: 2px;
            transition: all 0.3s;
            margin-top: 20px;
        }

        #begin-button:hover {
            background: var(--border-color);
            box-shadow: 0 0 20px var(--border-color);
        }

        /* --- LAYOUT DEL JUEGO (700px) --- */
        #scoreboard {
            width: 100%;
            max-width: 700px; /* Reducido un poco */
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 25px;
            background-color: var(--bg-color);
            border-bottom: 3px solid var(--border-color);
            box-sizing: border-box;
            border-radius: 8px 8px 0 0;
        }

        #game-container {
            position: relative;
            width: 700px; /* Tamaño equilibrado */
            height: 700px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.7);
            touch-action: none;
        }

        canvas {
            background-color: var(--bg-color);
            display: block;
            width: 100%;
            height: 100%;
        }

        #restart-button {
            background-color: #222;
            color: white;
            border: 1px solid #444;
            padding: 8px 15px;
            cursor: pointer;
            font-weight: bold;
        }

        #game-over-overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        @media (max-width: 720px) {
            #game-container, #scoreboard { width: 95vw; height: 95vw; }
            #scoreboard { height: auto; }
        }
    </style>
</head>
<body>

<div id="startup-screen">
    <div class="loader-wrapper">
        <h2 style="letter-spacing: 5px; color: #444;">SNAKE GAME</h2>
        <div class="snake-animation">
            <div class="moving-snake"></div>
            <div class="target-apple"></div>
        </div>
        <div id="loading-info">
            <div class="progress-container">
                <div class="progress-bar" id="p-bar"></div>
            </div>
            <p style="font-size: 12px; color: #555; margin-top: 10px;">CARGANDO RECURSOS...</p>
        </div>
        <button id="begin-button">INICIAR SESIÓN</button>
    </div>
</div>

<div id="scoreboard">
    <div>
        <span style="color: #888; font-size: 14px;">SCORE</span><br>
        <span id="score-text">0</span>
    </div>
    <div style="text-align: right;">
        <span style="color: #888; font-size: 14px;">BEST</span><br>
        <span id="high-score-text">0</span>
    </div>
    <button id="restart-button">REINICIAR</button>
</div>

<div id="game-container">
    <canvas id="snakeGame" width="700" height="700"></canvas>
    <div id="game-over-overlay">
        <h1 style="color: var(--accent-red); font-size: 50px; margin: 0;">¡FIN DEL JUEGO!</h1>
        <p id="final-score" style="font-size: 28px;">0</p>
        <p style="color: #666;">Pulsa 'R' para volver a intentar</p>
    </div>
</div>

<script>
    const GRID_SIZE = 25;
    const BOARD_SIZE = 700; 
    const COLUMNS = BOARD_SIZE / GRID_SIZE; // 28
    const ROWS = BOARD_SIZE / GRID_SIZE;
    const TIMER_DELAY = 115;

    const canvas = document.getElementById('snakeGame');
    const ctx = canvas.getContext('2d');
    const pBar = document.getElementById('p-bar');
    const beginBtn = document.getElementById('begin-button');
    const startup = document.getElementById('startup-screen');

    let snake = [], appleX, appleY, applesEaten = 0;
    let direction = 'R', running = false, gameTimer;
    let highScore = localStorage.getItem('snakeHighScore') || 0;

    // --- Simulación de Carga Real ---
    let progress = 0;
    const interval = setInterval(() => {
        progress += Math.random() * 15;
        if (progress > 100) {
            progress = 100;
            clearInterval(interval);
            document.getElementById('loading-info').style.display = 'none';
            beginBtn.style.display = 'inline-block';
        }
        pBar.style.width = progress + '%';
    }, 150);

    beginBtn.onclick = () => {
        startup.style.opacity = '0';
        setTimeout(() => {
            startup.style.display = 'none';
            startGame();
        }, 600);
    };

    function startGame() {
        snake = [];
        for (let i = 0; i < 6; i++) {
            snake.push({ x: (14 - i) * GRID_SIZE, y: 14 * GRID_SIZE });
        }
        applesEaten = 0;
        direction = 'R';
        running = true;
        document.getElementById('game-over-overlay').style.display = 'none';
        updateUI();
        spawnApple();
        if (gameTimer) clearInterval(gameTimer);
        gameTimer = setInterval(gameLoop, TIMER_DELAY);
    }

    function spawnApple() {
        let overlaps;
        do {
            overlaps = false;
            appleX = Math.floor(Math.random() * COLUMNS) * GRID_SIZE;
            appleY = Math.floor(Math.random() * ROWS) * GRID_SIZE;
            snake.forEach(p => { if(p.x === appleX && p.y === appleY) overlaps = true; });
        } while (overlaps);
    }

    function gameLoop() {
        if (!running) return;

        const head = { ...snake[0] };
        if (direction === 'U') head.y -= GRID_SIZE;
        else if (direction === 'D') head.y += GRID_SIZE;
        else if (direction === 'L') head.x -= GRID_SIZE;
        else if (direction === 'R') head.x += GRID_SIZE;

        if (head.x < 0 || head.x >= BOARD_SIZE || head.y < 0 || head.y >= BOARD_SIZE ||
            snake.some(p => p.x === head.x && p.y === head.y)) {
            endGame();
            return;
        }

        snake.unshift(head);

        if (head.x === appleX && head.y === appleY) {
            applesEaten++;
            updateUI();
            spawnApple();
        } else {
            snake.pop();
        }
        render();
    }

    function endGame() {
        running = false;
        clearInterval(gameTimer);
        if (applesEaten > highScore) {
            highScore = applesEaten;
            localStorage.setItem('snakeHighScore', highScore);
        }
        document.getElementById('final-score').innerText = `PUNTUACIÓN: ${applesEaten}`;
        document.getElementById('game-over-overlay').style.display = 'flex';
        updateUI();
    }

    function updateUI() {
        document.getElementById('score-text').innerText = applesEaten;
        document.getElementById('high-score-text').innerText = highScore;
    }

    function render() {
        ctx.fillStyle = '#0d0d0d';
        ctx.fillRect(0, 0, BOARD_SIZE, BOARD_SIZE);

        // Cuadrícula sutil
        ctx.strokeStyle = '#151515';
        for(let i=0; i<=BOARD_SIZE; i+=GRID_SIZE) {
            ctx.beginPath(); ctx.moveTo(i,0); ctx.lineTo(i,BOARD_SIZE); ctx.stroke();
            ctx.beginPath(); ctx.moveTo(0,i); ctx.lineTo(BOARD_SIZE,i); ctx.stroke();
        }

        // Borde
        ctx.strokeStyle = '#501414';
        ctx.lineWidth = 4;
        ctx.strokeRect(2, 2, BOARD_SIZE-4, BOARD_SIZE-4);

        // Manzana
        ctx.fillStyle = 'red';
        ctx.beginPath(); 
        ctx.arc(appleX+GRID_SIZE/2, appleY+GRID_SIZE/2, GRID_SIZE/2.2, 0, Math.PI*2); 
        ctx.fill();

        // Serpiente
        snake.forEach((p, i) => {
            ctx.fillStyle = (i === 0) ? '#32CD32' : '#228B22';
            ctx.fillRect(p.x, p.y, GRID_SIZE, GRID_SIZE);
            ctx.strokeStyle = '#0d0d0d';
            ctx.strokeRect(p.x, p.y, GRID_SIZE, GRID_SIZE);
        });
    }

    // Controles
    window.addEventListener('keydown', e => {
        const key = e.key.toLowerCase();
        if (key === 'r') startGame();
        if (!running) return;
        if ((key === 'arrowup' || key === 'w') && direction !== 'D') direction = 'U';
        else if ((key === 'arrowdown' || key === 's') && direction !== 'U') direction = 'D';
        else if ((key === 'arrowleft' || key === 'a') && direction !== 'R') direction = 'L';
        else if ((key === 'arrowright' || key === 'd') && direction !== 'L') direction = 'R';
    });

    // Swipe
    let touchStartX = 0, touchStartY = 0;
    canvas.addEventListener('touchstart', e => {
        touchStartX = e.changedTouches[0].screenX;
        touchStartY = e.changedTouches[0].screenY;
    }, false);

    canvas.addEventListener('touchend', e => {
        if (!running) return;
        let dx = e.changedTouches[0].screenX - touchStartX;
        let dy = e.changedTouches[0].screenY - touchStartY;
        if (Math.abs(dx) > Math.abs(dy)) {
            if (Math.abs(dx) > 30) direction = dx > 0 ? (direction !== 'L' ? 'R' : 'L') : (direction !== 'R' ? 'L' : 'R');
        } else {
            if (Math.abs(dy) > 30) direction = dy > 0 ? (direction !== 'U' ? 'D' : 'U') : (direction !== 'D' ? 'U' : 'D');
        }
    }, false);

    document.getElementById('restart-button').onclick = startGame;
</script>
</body>
</html>